blueprint:
  name: "IKEA Bilresa – 3 Buttons"
  description: "3 unabhängige Buttons (1×/2×/3× Klick + Hold-Dimmen pro Button) + Cover-Support"
  domain: automation

  input:
    # ════════════════════════════════════════════════════════════
    # BUTTON 1
    # ════════════════════════════════════════════════════════════
    button1_event_entity:
      name: "Button 1 – Event Entity"
      description: "Event Entity von Button 1"
      selector:
        entity:
          domain: event
  
    button1_single_press_light:
      name: "Button 1 – 1× Klick Lampe"
      selector:
        entity:
          domain: light
      default: ""
  
    button1_single_press_action:
      name: "Button 1 – 1× Klick Aktion"
      selector:
        select:
          options:
            - label: "Toggle (Ein/Aus)"
              value: "toggle"
            - label: "Einschalten"
              value: "turn_on"
            - label: "Ausschalten"
              value: "turn_off"
            - label: "25% Helligkeit"
              value: "brightness_25"
            - label: "50% Helligkeit"
              value: "brightness_50"
            - label: "75% Helligkeit"
              value: "brightness_75"
            - label: "100% Helligkeit"
              value: "brightness_100"
      default: "toggle"
  
    button1_double_press_light:
      name: "Button 1 – 2× Klick Lampe (optional)"
      selector:
        entity:
          domain: light
      default: ""
  
    button1_double_press_type:
      name: "Button 1 – 2× Klick Aktion-Typ"
      selector:
        select:
          options:
            - label: "Lampe (Helligkeit/Toggle)"
              value: "light"
            - label: "Szene aktivieren"
              value: "scene"
      default: "light"
  
    button1_double_press_light_action:
      name: "Button 1 – 2× Klick Aktion (Lampe)"
      selector:
        select:
          options:
            - label: "Toggle (Ein/Aus)"
              value: "toggle"
            - label: "Einschalten"
              value: "turn_on"
            - label: "Ausschalten"
              value: "turn_off"
            - label: "25% Helligkeit"
              value: "brightness_25"
            - label: "50% Helligkeit"
              value: "brightness_50"
            - label: "75% Helligkeit"
              value: "brightness_75"
            - label: "100% Helligkeit"
              value: "brightness_100"
      default: "brightness_50"
  
    button1_double_press_scene:
      name: "Button 1 – 2× Klick Szene (optional)"
      selector:
        entity:
          domain: scene
      default: ""
  
    button1_triple_press_light:
      name: "Button 1 – 3× Klick Lampe (optional)"
      selector:
        entity:
          domain: light
      default: ""
  
    button1_triple_press_type:
      name: "Button 1 – 3× Klick Aktion-Typ"
      selector:
        select:
          options:
            - label: "Lampe (Helligkeit/Toggle)"
              value: "light"
            - label: "Szene aktivieren"
              value: "scene"
      default: "light"
  
    button1_triple_press_light_action:  
      name: "Button 1 – 3× Klick Aktion (Lampe)"
      selector:
        select:
          options:
            - label: "Toggle (Ein/Aus)"
              value: "toggle"
            - label: "Einschalten"
              value: "turn_on"
            - label: "Ausschalten"
              value: "turn_off"
            - label: "25% Helligkeit"
              value: "brightness_25"
            - label: "50% Helligkeit"
              value: "brightness_50"
            - label: "75% Helligkeit"
              value: "brightness_75"
            - label: "100% Helligkeit"
              value: "brightness_100"
      default: "brightness_100"
  
    button1_triple_press_scene:  
      name: "Button 1 – 3× Klick Szene (optional)"
      selector:
        entity:
          domain: scene
      default: ""
  
    button1_hold_light:
      name: "Button 1 – Halten/Loslassen Lampe (optional)"
      selector:
        entity:
          domain: light
      default: ""
  
    button1_hold_direction:
      name: "Button 1 – Dimmrichtung beim Halten"
      selector:
        select:
          options:
            - label: "Heller werden (erhöhen)"
              value: "brighter"
            - label: "Dunkler werden (reduzieren)"
              value: "darker"
      default: "brighter"
  
    button1_hold_brightness_step:
      name: "Button 1 – Helligkeit pro Schritt (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

    # ════════════════════════════════════════════════════════════
    # BUTTON 2
    # ════════════════════════════════════════════════════════════
    button2_event_entity:
      name: "Button 2 – Event Entity (optional)"
      selector:
        entity:
          domain: event
      default: ""
  
    button2_single_press_light:
      name: "Button 2 – 1× Klick Lampe"
      selector:
        entity:
          domain: light
      default: ""
  
    button2_single_press_action:
      name: "Button 2 – 1× Klick Aktion"
      selector:
        select:
          options:
            - label: "Toggle (Ein/Aus)"
              value: "toggle"
            - label: "Einschalten"
              value: "turn_on"
            - label: "Ausschalten"
              value: "turn_off"
            - label: "25% Helligkeit"
              value: "brightness_25"
            - label: "50% Helligkeit"
              value: "brightness_50"
            - label: "75% Helligkeit"
              value: "brightness_75"
            - label: "100% Helligkeit"
              value: "brightness_100"
      default: "toggle"
  
    button2_double_press_light:
      name: "Button 2 – 2× Klick Lampe (optional)"
      selector:
        entity:
          domain: light
      default: ""
  
    button2_double_press_type:
      name: "Button 2 – 2× Klick Aktion-Typ"
      selector:
        select:
          options:
            - label: "Lampe (Helligkeit/Toggle)"
              value: "light"
            - label: "Szene aktivieren"
              value: "scene"
      default: "light"
  
    button2_double_press_light_action:
      name: "Button 2 – 2× Klick Aktion (Lampe)"
      selector:
        select:
          options:
            - label: "Toggle (Ein/Aus)"
              value: "toggle"
            - label: "Einschalten"
              value: "turn_on"
            - label: "Ausschalten"
              value: "turn_off"
            - label: "25% Helligkeit"
              value: "brightness_25"
            - label: "50% Helligkeit"
              value: "brightness_50"
            - label: "75% Helligkeit"
              value: "brightness_75"
            - label: "100% Helligkeit"
              value: "brightness_100"
      default: "brightness_50"
  
    button2_double_press_scene:
      name: "Button 2 – 2× Klick Szene (optional)"
      selector:
        entity:
          domain: scene
      default: ""
  
    button2_triple_press_light:
      name: "Button 2 – 3× Klick Lampe (optional)"
      selector:
        entity:
          domain: light
      default: ""
  
    button2_triple_press_type:
      name: "Button 2 – 3× Klick Aktion-Typ"
      selector:
        select:
          options:
            - label: "Lampe (Helligkeit/Toggle)"
              value: "light"
            - label: "Szene aktivieren"
              value: "scene"
      default: "light"
  
    button2_triple_press_light_action:
      name: "Button 2 – 3× Klick Aktion (Lampe)"
      selector:
        select:
          options:
            - label: "Toggle (Ein/Aus)"
              value: "toggle"
            - label: "Einschalten"
              value: "turn_on"
            - label: "Ausschalten"
              value: "turn_off"
            - label: "25% Helligkeit"
              value: "brightness_25"
            - label: "50% Helligkeit"
              value: "brightness_50"
            - label: "75% Helligkeit"
              value: "brightness_75"
            - label: "100% Helligkeit"
              value: "brightness_100"
      default: "brightness_100"
  
    button2_triple_press_scene:
      name: "Button 2 – 3× Klick Szene (optional)"
      selector:
        entity:
          domain: scene
      default: ""
  
    button2_hold_light:
      name: "Button 2 – Halten/Loslassen Lampe (optional)"
      selector:
        entity:
          domain: light
      default: ""
  
    button2_hold_direction:
      name: "Button 2 – Dimmrichtung beim Halten"
      selector:
        select:
          options:
            - label: "Heller werden (erhöhen)"
              value: "brighter"
            - label: "Dunkler werden (reduzieren)"
              value: "darker"
      default: "brighter"
  
    button2_hold_brightness_step:
      name: "Button 2 – Helligkeit pro Schritt (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

    # ════════════════════════════════════════════════════════════
    # BUTTON 3 (mit Cover-Support)
    # ════════════════════════════════════════════════════════════
    button3_event_entity:
      name: "Button 3 – Event Entity (optional)"
      selector:
        entity:
          domain: event
      default: ""
  
    button3_single_press_light:
      name: "Button 3 – 1× Klick Lampe"
      selector:
        entity:
          domain: light
      default: ""
  
    button3_single_press_type:
      name: "Button 3 – 1× Klick – Aktion-Typ"
      selector:
        select:
          options:
            - label: "Lampe (Helligkeit/Toggle)"
              value: "light"
            - label: "Szene aktivieren"
              value: "scene"
            - label: "Vorhang / Cover (Öffnen/Schließen)"
              value: "cover"
      default: "light"
  
    button3_single_press_action:
      name: "Button 3 – 1× Klick Aktion"
      selector:
        select:
          options:
            - label: "Toggle (Ein/Aus)"
              value: "toggle"
            - label: "Einschalten"
              value: "turn_on"
            - label: "Ausschalten"
              value: "turn_off"
            - label: "25% Helligkeit"
              value: "brightness_25"
            - label: "50% Helligkeit"
              value: "brightness_50"
            - label: "75% Helligkeit"
              value: "brightness_75"
            - label: "100% Helligkeit"
              value: "brightness_100"
      default: "toggle"
  
    button3_single_press_scene:
      name: "Button 3 – 1× Klick Szene (optional)"
      selector:
        entity:
          domain: scene
      default: ""
  
    button3_single_press_cover:
      name: "Button 3 – 1× Klick – Cover/Vorhang (optional)"
      selector:
        entity:
          domain: cover
      default: ""
  
    button3_single_press_cover_action:
      name: "Button 3 – 1× Klick – Cover-Aktion"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Öffnen"
              value: "open"
            - label: "Schließen"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "open"
  
    button3_double_press_light:
      name: "Button 3 – 2× Klick Lampe (optional)"
      selector:
        entity:
          domain: light
      default: ""
  
    button3_double_press_type:
      name: "Button 3 – 2× Klick – Aktion-Typ"
      selector:
        select:
          options:
            - label: "Lampe (Helligkeit/Toggle)"
              value: "light"
            - label: "Szene aktivieren"
              value: "scene"
            - label: "Vorhang / Cover (Öffnen/Schließen)"
              value: "cover"
      default: "light"
  
    button3_double_press_light_action:
      name: "Button 3 – 2× Klick Aktion (Lampe)"
      selector:
        select:
          options:
            - label: "Toggle (Ein/Aus)"
              value: "toggle"
            - label: "Einschalten"
              value: "turn_on"
            - label: "Ausschalten"
              value: "turn_off"
            - label: "25% Helligkeit"
              value: "brightness_25"
            - label: "50% Helligkeit"
              value: "brightness_50"
            - label: "75% Helligkeit"
              value: "brightness_75"
            - label: "100% Helligkeit"
              value: "brightness_100"
      default: "brightness_50"
  
    button3_double_press_scene:
      name: "Button 3 – 2× Klick Szene (optional)"
      selector:
        entity:
          domain: scene
      default: ""
  
    button3_double_press_cover:
      name: "Button 3 – 2× Klick – Cover/Vorhang (optional)"
      selector:
        entity:
          domain: cover
      default: ""
  
    button3_double_press_cover_action:
      name: "Button 3 – 2× Klick – Cover-Aktion"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Öffnen"
              value: "open"
            - label: "Schließen"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "open"
  
    button3_triple_press_light:
      name: "Button 3 – 3× Klick Lampe (optional)"
      selector:
        entity:
          domain: light
      default: ""
  
    button3_triple_press_type:
      name: "Button 3 – 3× Klick Aktion-Typ"
      selector:
        select:
          options:
            - label: "Lampe (Helligkeit/Toggle)"
              value: "light"
            - label: "Szene aktivieren"
              value: "scene"
            - label: "Vorhang / Cover (Öffnen/Schließen)"
              value: "cover"
      default: "light"
  
    button3_triple_press_light_action:
      name: "Button 3 – 3× Klick Aktion (Lampe)"
      selector:
        select:
          options:
            - label: "Toggle (Ein/Aus)"
              value: "toggle"
            - label: "Einschalten"
              value: "turn_on"
            - label: "Ausschalten"
              value: "turn_off"
            - label: "25% Helligkeit"
              value: "brightness_25"
            - label: "50% Helligkeit"
              value: "brightness_50"
            - label: "75% Helligkeit"
              value: "brightness_75"
            - label: "100% Helligkeit"
              value: "brightness_100"
      default: "brightness_100"
  
    button3_triple_press_scene:
      name: "Button 3 – 3× Klick Szene (optional)"
      selector:
        entity:
          domain: scene
      default: ""
  
    button3_triple_press_cover:
      name: "Button 3 – 3× Klick – Cover/Vorhang (optional)"
      selector:
        entity:
          domain: cover
      default: ""
  
    button3_triple_press_cover_action:
      name: "Button 3 – 3× Klick – Cover-Aktion"
      selector:
        select:
          options:
            - label: "Toggle"
              value: "toggle"
            - label: "Öffnen"
              value: "open"
            - label: "Schließen"
              value: "close"
            - label: "Stop"
              value: "stop"
      default: "open"
  
    button3_hold_light:
      name: "Button 3 – Halten/Loslassen Lampe (optional)"
      selector:
        entity:
          domain: light
      default: ""
  
    button3_hold_direction:
      name: "Button 3 – Dimmrichtung beim Halten"
      selector:
        select:
          options:
            - label: "Heller werden (erhöhen)"
              value: "brighter"
            - label: "Dunkler werden (reduzieren)"
              value: "darker"
      default: "brighter"
  
    button3_hold_brightness_step:
      name: "Button 3 – Helligkeit pro Schritt (%)"
      default: 5
      selector:
        number:
          min: 1
          max: 20
          unit_of_measurement: "%"

trigger:
  - platform: state
    entity_id:
      - !input button1_event_entity
    id: button1
  
  - platform: state
    entity_id:
      - !input button2_event_entity
    id: button2
  
  - platform: state
    entity_id:
      - !input button3_event_entity
    id: button3

condition: []

action:
  - variables:
      button1_event: !input button1_event_entity
      button2_event: !input button2_event_entity
      button3_event: !input button3_event_entity
      
      button1_single_press_light_value: !input button1_single_press_light
      button1_single_press_action_value: !input button1_single_press_action
      button1_double_press_light_value: !input button1_double_press_light
      button1_double_press_type_value: !input button1_double_press_type
      button1_double_press_light_action_value: !input button1_double_press_light_action
      button1_double_press_scene_value: !input button1_double_press_scene
      button1_triple_press_light_value: !input button1_triple_press_light
      button1_triple_press_type_value: !input button1_triple_press_type
      button1_triple_press_light_action_value: !input button1_triple_press_light_action
      button1_triple_press_scene_value: !input button1_triple_press_scene
      button1_hold_light_value: !input button1_hold_light
      button1_hold_direction_value: !input button1_hold_direction
      button1_hold_brightness_step_value: !input button1_hold_brightness_step
      
      button2_single_press_light_value: !input button2_single_press_light
      button2_single_press_action_value: !input button2_single_press_action
      button2_double_press_light_value: !input button2_double_press_light
      button2_double_press_type_value: !input button2_double_press_type
      button2_double_press_light_action_value: !input button2_double_press_light_action
      button2_double_press_scene_value: !input button2_double_press_scene
      button2_triple_press_light_value: !input button2_triple_press_light
      button2_triple_press_type_value: !input button2_triple_press_type
      button2_triple_press_light_action_value: !input button2_triple_press_light_action
      button2_triple_press_scene_value: !input button2_triple_press_scene
      button2_hold_light_value: !input button2_hold_light
      button2_hold_direction_value: !input button2_hold_direction
      button2_hold_brightness_step_value: !input button2_hold_brightness_step
      
      button3_single_press_type_var: !input button3_single_press_type
      button3_single_press_light_value: !input button3_single_press_light
      button3_single_press_action_value: !input button3_single_press_action
      button3_single_press_scene_var: !input button3_single_press_scene
      button3_single_press_cover_var: !input button3_single_press_cover
      button3_single_press_cover_action_var: !input button3_single_press_cover_action
      
      button3_double_press_type_var: !input button3_double_press_type
      button3_double_press_light_value: !input button3_double_press_light
      button3_double_press_light_action_value: !input button3_double_press_light_action
      button3_double_press_scene_var: !input button3_double_press_scene
      button3_double_press_cover_var: !input button3_double_press_cover
      button3_double_press_cover_action_var: !input button3_double_press_cover_action
      
      button3_triple_press_type_var: !input button3_triple_press_type
      button3_triple_press_light_value: !input button3_triple_press_light
      button3_triple_press_light_action_value: !input button3_triple_press_light_action
      button3_triple_press_scene_var: !input button3_triple_press_scene
      button3_triple_press_cover_var: !input button3_triple_press_cover
      button3_triple_press_cover_action_var: !input button3_triple_press_cover_action
      
      button3_hold_light_value: !input button3_hold_light
      button3_hold_direction_value: !input button3_hold_direction
      button3_hold_brightness_step_value: !input button3_hold_brightness_step
      
      event_type: "{{ state_attr(trigger.entity_id, 'event_type') }}"
      trigger_entity: "{{ trigger.entity_id }}"

  # ════════════════════════════════════════════════════════════
  # BUTTON 1 - 1× KLICK
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and event_type == 'multi_press_1' and button1_single_press_light_value != '' }}"
    then:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'toggle' }}"
            sequence:
              - service: light.toggle
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'turn_on' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'turn_off' }}"
            sequence:
              - service: light.turn_off
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_25' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 25
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_50' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 50
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_75' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 75
          - conditions:
              - condition: template
                value_template: "{{ button1_single_press_action_value == 'brightness_100' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button1_single_press_light_value }}"
                data:
                  brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 1 - 2× KLICK
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and event_type == 'multi_press_2' and button1_double_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button1_double_press_type_value == 'scene' and button1_double_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button1_double_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button1_double_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_double_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 1 - 3× KLICK
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and event_type == 'multi_press_3' and button1_triple_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button1_triple_press_type_value == 'scene' and button1_triple_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button1_triple_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button1_triple_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button1_triple_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 1 - HALTEN/LOSLASSEN
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button1_event and (event_type == 'initial_press' or event_type == 'repeat') and button1_hold_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button1_hold_direction_value == 'brighter' }}"
        then:
          - service: light.turn_on
            target:
              entity_id: "{{ button1_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button1_hold_brightness_step_value }}"
        else:
          - service: light.turn_on
            target:
              entity_id: "{{ button1_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button1_hold_brightness_step_value * -1 }}"

  # ════════════════════════════════════════════════════════════
  # BUTTON 2 - 1× KLICK
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and event_type == 'multi_press_1' and button2_single_press_light_value != '' }}"
    then:
      - choose:
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'toggle' }}"
            sequence:
              - service: light.toggle
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'turn_on' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'turn_off' }}"
            sequence:
              - service: light.turn_off
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_25' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 25
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_50' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 50
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_75' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 75
          - conditions:
              - condition: template
                value_template: "{{ button2_single_press_action_value == 'brightness_100' }}"
            sequence:
              - service: light.turn_on
                target:
                  entity_id: "{{ button2_single_press_light_value }}"
                data:
                  brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 2 - 2× KLICK
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and event_type == 'multi_press_2' and button2_double_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button2_double_press_type_value == 'scene' and button2_double_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button2_double_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button2_double_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_double_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 2 - 3× KLICK
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and event_type == 'multi_press_3' and button2_triple_press_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button2_triple_press_type_value == 'scene' and button2_triple_press_scene_value != '' }}"
        then:
          - service: scene.turn_on
            target:
              entity_id: "{{ button2_triple_press_scene_value }}"
        else:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'toggle' }}"
                sequence:
                  - service: light.toggle
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'turn_on' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'turn_off' }}"
                sequence:
                  - service: light.turn_off
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_25' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 25
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_50' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 50
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_75' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 75
              - conditions:
                  - condition: template
                    value_template: "{{ button2_triple_press_light_action_value == 'brightness_100' }}"
                sequence:
                  - service: light.turn_on
                    target:
                      entity_id: "{{ button2_triple_press_light_value }}"
                    data:
                      brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 2 - HALTEN/LOSLASSEN
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button2_event and (event_type == 'initial_press' or event_type == 'repeat') and button2_hold_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button2_hold_direction_value == 'brighter' }}"
        then:
          - service: light.turn_on
            target:
              entity_id: "{{ button2_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button2_hold_brightness_step_value }}"
        else:
          - service: light.turn_on
            target:
              entity_id: "{{ button2_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button2_hold_brightness_step_value * -1 }}"

  # ════════════════════════════════════════════════════════════
  # BUTTON 3 - 1× KLICK (KORRIGIERT)
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and event_type == 'multi_press_1' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_single_press_type_var == 'cover' and button3_single_press_cover_var != '' }}"
        then:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'toggle' }}"
                sequence:
                  - service: cover.toggle
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'open' }}"
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'close' }}"
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_single_press_cover_action_var == 'stop' }}"
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: "{{ button3_single_press_cover_var }}"
        else:
          - if:
              - condition: template
                value_template: "{{ button3_single_press_type_var == 'scene' and button3_single_press_scene_var != '' }}"
            then:
              - service: scene.turn_on
                target:
                  entity_id: "{{ button3_single_press_scene_var }}"
            else:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 25
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 50
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 75
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_single_press_light_value != '' and button3_single_press_action_value == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_single_press_light_value }}"
                        data:
                          brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 3 - 2× KLICK (KORRIGIERT)
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and event_type == 'multi_press_2' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_double_press_type_var == 'cover' and button3_double_press_cover_var != '' }}"
        then:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'toggle' }}"
                sequence:
                  - service: cover.toggle
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'open' }}"
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'close' }}"
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_double_press_cover_action_var == 'stop' }}"
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: "{{ button3_double_press_cover_var }}"
        else:
          - if:
              - condition: template
                value_template: "{{ button3_double_press_type_var == 'scene' and button3_double_press_scene_var != '' }}"
            then:
              - service: scene.turn_on
                target:
                  entity_id: "{{ button3_double_press_scene_var }}"
            else:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 25
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 50
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 75
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_double_press_light_value != '' and button3_double_press_light_action_value == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_double_press_light_value }}"
                        data:
                          brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 3 - 3× KLICK (KORRIGIERT)
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and event_type == 'multi_press_3' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_triple_press_type_var == 'cover' and button3_triple_press_cover_var != '' }}"
        then:
          - choose:
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'toggle' }}"
                sequence:
                  - service: cover.toggle
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'open' }}"
                sequence:
                  - service: cover.open_cover
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'close' }}"
                sequence:
                  - service: cover.close_cover
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
              - conditions:
                  - condition: template
                    value_template: "{{ button3_triple_press_cover_action_var == 'stop' }}"
                sequence:
                  - service: cover.stop_cover
                    target:
                      entity_id: "{{ button3_triple_press_cover_var }}"
        else:
          - if:
              - condition: template
                value_template: "{{ button3_triple_press_type_var == 'scene' and button3_triple_press_scene_var != '' }}"
            then:
              - service: scene.turn_on
                target:
                  entity_id: "{{ button3_triple_press_scene_var }}"
            else:
              - choose:
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'toggle' }}"
                    sequence:
                      - service: light.toggle
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'turn_on' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'turn_off' }}"
                    sequence:
                      - service: light.turn_off
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_25' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 25
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_50' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 50
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_75' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 75
                  - conditions:
                      - condition: template
                        value_template: "{{ button3_triple_press_light_value != '' and button3_triple_press_light_action_value == 'brightness_100' }}"
                    sequence:
                      - service: light.turn_on
                        target:
                          entity_id: "{{ button3_triple_press_light_value }}"
                        data:
                          brightness_pct: 100

  # ════════════════════════════════════════════════════════════
  # BUTTON 3 - HALTEN/LOSLASSEN
  # ════════════════════════════════════════════════════════════
  - if:
      - condition: template
        value_template: "{{ trigger_entity == button3_event and (event_type == 'initial_press' or event_type == 'repeat') and button3_hold_light_value != '' }}"
    then:
      - if:
          - condition: template
            value_template: "{{ button3_hold_direction_value == 'brighter' }}"
        then:
          - service: light.turn_on
            target:
              entity_id: "{{ button3_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button3_hold_brightness_step_value }}"
        else:
          - service: light.turn_on
            target:
              entity_id: "{{ button3_hold_light_value }}"
            data:
              brightness_step_pct: "{{ button3_hold_brightness_step_value * -1 }}"

mode: parallel
max: 10
